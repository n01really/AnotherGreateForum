@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<style>
    .user-avatar {
        position: absolute;
        top: 12px;
        right: 15px;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #fff;
        box-shadow: 0 0 3px rgba(0,0,0,0.3);
        cursor: pointer;
        display: none;
    }
</style>

<!-- Messages button (hidden by default) -->
<button id="messagesBtn" class="btn btn-outline-primary"
        style="position:absolute; top:12px; right:60px; display:none;">
    Messages
</button>

<img id="userAvatar" class="user-avatar" alt="Profile Picture" />

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
</div>

<script>
    (async () => {
        try {
            const response = await fetch("https://localhost:7242/users/current", {
                method: "GET",
                credentials: "include"
            });

            if (!response.ok) return;

            const user = await response.json();

            // Show avatar
            const img = document.getElementById("userAvatar");
            if (user.profilePictureUrl) {
                img.src = `https://localhost:7242${user.profilePictureUrl}`;
            } else {
                img.src = "/images/default-avatar.png";
            }
            img.style.display = "block";

            img.addEventListener("click", () => {
                window.location.href = '@Url.Page("/Profile")';
            });

            // Show messages button
            const msgBtn = document.getElementById("messagesBtn");
            msgBtn.style.display = "block";
            msgBtn.addEventListener("click", () => {
                window.location.href = '@Url.Page("/Messages")';
            });

        } catch (err) {
            console.error("Failed to load user data:", err);
        }
    })();
</script>
