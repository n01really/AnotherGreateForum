@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<style>
    .user-avatar {
        position: absolute;
        top: 12px; /* Adjust to fit navbar */
        right: 15px; /* Adjust to fit navbar */
        width: 35px; /* smaller circle */
        height: 35px; /* smaller circle */
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #fff;
        box-shadow: 0 0 3px rgba(0,0,0,0.3);
        cursor: pointer;
        display: none; /* hidden by default, shown if user logged in */
    }
</style>

<img id="userAvatar" class="user-avatar" alt="Profile Picture" />

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
</div>

<script>
    (async () => {
        try {
            const response = await fetch("https://localhost:7242/users/current", {
                method: "GET",
                credentials: "include"
            });

            if (!response.ok) return;

            const user = await response.json();
            const img = document.getElementById("userAvatar");

            if (user.profilePictureUrl) {
                img.src = `https://localhost:7242${user.profilePictureUrl}`;
            } else {
                img.src = "/images/default-avatar.png"; // fallback default avatar
            }

            img.style.display = "block"; // show avatar

            // Make avatar clickable to go to profile page
            img.addEventListener("click", () => {
                window.location.href = '@Url.Page("/Profile")';
            });

        } catch (err) {
            console.error("Failed to load user avatar:", err);
        }
    })();
</script>
